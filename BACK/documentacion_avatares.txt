DOCUMENTACIÓN: VISUALIZACIÓN DE AVATARES EN EL FRONTEND
=======================================================

Este documento detalla los pasos, librerías y métodos implementados en el Backend para permitir que las imágenes de los avatares (archivos locales) sean accesibles y visualizables desde el Frontend.

1. LIBRERÍAS UTILIZADAS
-----------------------
- express: Framework web utilizado para crear el servidor y manejar las rutas.
- path: Módulo nativo de Node.js utilizado para construir rutas de archivos compatibles con el sistema operativo.
- cors: Middleware para permitir Cross-Origin Resource Sharing. Es fundamental para que el navegador permita cargar imágenes desde `localhost:3000` cuando la web está en otro puerto (ej: 5173).

2. CONFIGURACIÓN DEL SERVIDOR (index.js)
----------------------------------------
Para que los archivos físicos guardados en la carpeta del servidor sean accesibles públicamente vía URL, se configuró una "carpeta estática".

A. Servir archivos estáticos:
   Método: `express.static`
   Código implementado:
   `app.use('/images', express.static(path.join(__dirname, 'public/images')));`

   Explicación:
   - Esto crea una ruta virtual `/images`.
   - Cuando se pide `http://localhost:3000/images/foto.png`, Express busca el archivo físico en la carpeta `public/images` del proyecto.

3. LÓGICA EN LOS CONTROLADORES
------------------------------
El frontend necesita una URL absoluta (completa) para poner en la etiqueta `<img src="...">`. Sin embargo, en la base de datos solemos guardar solo el nombre del archivo o una ruta relativa.

Archivos donde se aplicó:
- `controllers/perfilController.js` (función `verPerfiles`)
- `controllers/avatarsController.js` (función `verAvatares`)

Pasos lógicos implementados (Algoritmo):

A. Obtener la URL base del servidor dinámicamente:
   Se usan los métodos del objeto `req` (request) de Express.
   `const baseUrl = \`${req.protocol}://${req.get('host')}\`;`
   // Resultado dinámico: "http://localhost:3000" (o el dominio en producción).

B. Transformar los datos (Map):
   Antes de enviar la respuesta JSON, iteramos sobre los objetos para modificar la propiedad `url` de la imagen.

C. Validación y Construcción:
   1. Se verifica si la imagen ya es externa (empieza con 'http'). Si es así, no se toca.
   2. Si es local, se asegura que la ruta empiece con `/images/`.
   3. Se concatena la base + la ruta relativa.

   Código ejemplo:
   `p.avatar.url = \`${baseUrl}/images/${p.avatar.url}\`;`

4. RESUMEN DEL FLUJO DE DATOS
-----------------------------
1. Frontend pide lista de perfiles.
2. Backend busca en DB -> Transforma ruta relativa a URL absoluta -> Envía JSON.
3. Frontend recibe URL (ej: `http://localhost:3000/images/avatar1.png`).
4. Navegador hace petición GET a esa URL -> `index.js` sirve el archivo estático gracias a `express.static`.